#!/usr/bin/env bash

# clean up previous session
which killall >/dev/null 2>&1 \
    && killall aseba{switch,dummynode} \
    || ps | egrep 'aseba(switch|dummynode)' | while read pid rest; do kill $pid; done
sleep 3

# run switch
@ASEBASWITCH@ 1>&2 &

sleep 5 # let switch start up

# run e2e tests
node_modules/jasmine-node/bin/jasmine-node .
status=$?

# clean up
[ -z "$(jobs -p)" ] || kill %%

exit $status
